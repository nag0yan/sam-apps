# 画像アップロード・取得API 要件

## 目的

このAPIは、**AWS SAM** を使って、ファイルのアップロードと取得を伴うサーバーレスAPIを開発する能力を養うことを目的としています。特に、**API Gateway と S3 の連携**、そして**簡単な認証**の概念を学びます。

---

## 機能要件

### 1. 画像のアップロード (POST /images)

* クライアントは、画像ファイル（JPEG, PNG, GIF など）をバイナリデータとしてこのエンドポイントにアップロードします。
* **Lambda 関数** はアップロードされた画像データを受け取り、**ユニークなファイル名**（例: UUID を使用）を生成して、指定された **S3 バケット** に保存します。
* 保存後、Lambda 関数はアップロードされた画像の**公開アクセス可能な S3 URL** (または、一時的にアクセス可能な**プリサインURL** も検討) をクライアントに返します。
* 処理が成功した場合、HTTPステータス: `201 Created` を返します。

### 2. 画像の一覧取得 (GET /images)

* **Lambda 関数** は指定された **S3 バケット**内の全ての画像ファイルのリストを取得します。
* 各画像ファイルについて、その**ファイル名**と対応する **S3 URL** を含んだリストをクライアントに返します。
* 画像がない場合は空のリストを返します（HTTPステータス: `200 OK`）。

### 3. 特定の画像の取得 (GET /images/{key})

* パスパラメータとして指定された **key** (S3 上のファイル名) に一致する画像ファイルを **S3 バケット**から取得します。
* 取得した画像を**バイナリデータ**としてクライアントに返します。
* 画像が見つからない場合は `404 Not Found` エラーを返します。
* **注意点**: **API Gateway** がバイナリデータを適切に扱うための設定（**バイナリメディアタイプ**）が必要です。

### 4. 簡易認証 (POST /images と PUT /images)

* アップロード操作 (`POST /images`) および将来的な削除操作 (`DELETE /images/{key}` を追加する場合) について、簡単な認証メカニズムを導入します。
* **API キー** を利用した認証を実装し、API キーが正しく指定された場合のみ操作を許可するようにします。これにより、誰でも画像をアップロードできる状況を避けます。
* **オプション**: もし余裕があれば、**Cognito User Pools** を使った認証に挑戦しても良いでしょう。

---

## 技術要件

* **フレームワーク**: **AWS Serverless Application Model (SAM)**
* **API Gateway**: **REST API** を使用し、各エンドポイントを **Lambda 関数**に連携させます。**バイナリメディアタイプ** の設定が重要です。
* **Lambda 関数**: Python, Node.js, Go など、慣れている言語で実装します。画像アップロード用、一覧取得用、単一画像取得用の**3つの Lambda 関数**を基本とします。
* **オブジェクトストレージ**: **Amazon S3** を使用し、画像を保存するバケットを作成します。バケットの**アクセス権限（ポリシー）**にも注意が必要です。
* **認証**: **API Gateway の API キー機能** を活用します。
* **IAM ロール**: **Lambda 関数**が **S3 バケット**へのアクセス（読み取り、書き込み）に必要な**適切な権限**を持つ **IAM ロール**を設定します。
